(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9535"],{"+DZj":function(t,e,a){"use strict";var n=a("dtGf");a.n(n).a},G31v:function(t,e,a){},dtGf:function(t,e,a){},r6jR:function(t,e,a){"use strict";var n=a("G31v");a.n(n).a},"uCM+":function(t,e,a){"use strict";a.r(e);var n=a("jWXv"),r=a.n(n),i=a("t3Un");function s(t){var e=new URLSearchParams;return e.append("parentId",t),Object(i.a)({url:"system/sysDepartment/getChildDepartmentByParentId",method:"post",data:e})}var o={data:function(){var t=this;return{isData:!1,currentId:void 0,isDepartmentInfo:!1,isSubForm:!1,subForm:{departmentData:[]},currentDepartmentName:void 0,checkoutParentId:void 0,checkoutId:void 0,visible:!1,location:"1",oldDepartmentName:void 0,isDisabled:!1,departmentForm:{parentId:void 0,id:void 0,departmentName:void 0},departmentDialogVisible:!1,dialogStatus:void 0,listLoading:!1,departmentList:[],rules:{departmentName:[{required:!0,message:"请输入部门名称",trigger:"blur"},{validator:function(e,a,n){/^[\u4e00-\u9fa5\w]{1,20}$/.test(a)?t.oldDepartmentName!==t.departmentForm.departmentName?function(t){return Object(i.a)({url:"system/sysDepartment/checkDepartmentName",method:"post",data:t})}({departmentName:t.departmentForm.departmentName,parentId:t.departmentForm.parentId}).then(function(t){"0000"===t.data.code&&("success"===t.data.data?n():n(new Error("部门名称已重复")))}):n():n(new Error("名称只允许数字、中文、字母及下划线"))},trigger:"blur"}]},departmentDataRules:{label:[{required:!0,message:"请输入部门名称",trigger:"blur"},{validator:function(e,a,n){if(/^[\u4e00-\u9fa5\w]{1,20}$/.test(a)){var r=0;t.subForm.departmentData.forEach(function(t,e){a===t.label&&(r+=1)}),r>1?n(new Error("部门名称已重复")):n()}else n(new Error("名称只允许数字、中文、字母及下划线"))},trigger:"blur"}]}}},watch:{location:function(){"1"===this.location?this.departmentForm.parentId=this.checkoutParentId:"0"===this.location&&(this.departmentForm.parentId=this.checkoutId,console.log(this.departmentForm.parentId))}},mounted:function(){this.initList()},methods:{checkoutSubName:function(){var t=[];this.subForm.departmentData.forEach(function(e){t.push(e.label)}),new r.a(t).size===t.length&&this.$refs.subForm.clearValidate()},cencalEdit:function(t){var e=this;s(this.currentId).then(function(t){"0000"===t.data.code?(e.subForm.departmentData=t.data.data,e.$refs.subForm.clearValidate()):e.$message.error(t.data.result),e.initList()})},submitDepartmentInfo:function(t){var e=this,a=[];this.subForm.departmentData.forEach(function(t){a.push({id:t.value,departmentName:t.label,parentId:e.currentId})}),this.$refs.subForm.validate(function(t){t&&(e.isDisabled=!0,function(t){return Object(i.a)({url:"system/sysDepartment/addDepartmentBatch",method:"post",data:t})}(a).then(function(t){"0000"===t.data.code?e.$message({message:"保存成功",type:"success"}):e.$message.error(t.data.result),e.isDisabled=!1,e.initList()}))})},handleNodeClick:function(t){this.isData=!0,this.currentId=t.value,this.currentDepartmentName=t.label,null===t.children?(this.isDepartmentInfo=!1,this.isSubForm=!0):(this.isSubForm=!1,this.isDepartmentInfo=!0,this.subForm.departmentData=t.children);var e=[];this.subForm.departmentData.forEach(function(t){e.push(t.label)}),new r.a(e).size===e.length&&this.$refs.subForm.clearValidate()},deleteDepartment:function(t){var e=this;console.log(t),this.$confirm("此操作将永久删除这个部门及其子部门, 是否继续?","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){var e=new URLSearchParams;return e.append("departmentId",t),Object(i.a)({url:"system/sysDepartment/delete",method:"post",data:e})})(t).then(function(a){"0000"===a.data.code?(e.$message({message:"删除成功",type:"success"}),e.currentId===t?(e.isData=!1,e.initList()):e.isData=!0):e.$message.error(a.data.result)})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},editDepartment:function(t){var e=this;this.visible=!1,this.dialogStatus="编辑部门",this.oldDepartmentName=t.label,this.departmentForm.id=t.value,this.departmentDialogVisible=!0,this.departmentForm.departmentName=t.label,t.parentName?this.departmentForm.parentId=t.parentId:this.departmentForm.parentId="1",this.$nextTick(function(){e.$refs.departmentForm.clearValidate()})},updateData:function(){var t=this;this.$refs.departmentForm.validate(function(e){e&&(t.isDisabled=!0,t.departmentDialogVisible=!1,console.log(t.departmentForm),function(t){return Object(i.a)({url:"system/sysDepartment/update",method:"post",data:t})}(t.departmentForm).then(function(e){"0000"===e.data.code?t.$message({message:"编辑成功",type:"success"}):t.$message.error(e.data.result),t.isDisabled=!1,t.$refs.departmentForm.resetFields(),t.initList(),t.updataRight()}))})},createData:function(){var t=this;this.$refs.departmentForm.validate(function(e){e&&(t.isDisabled=!0,function(t){return Object(i.a)({url:"system/sysDepartment/add",method:"post",data:t})}(t.departmentForm).then(function(e){"0000"===e.data.code?(t.$message({message:"添加成功",type:"success"}),t.departmentDialogVisible=!1):t.$message.error(e.data.result),t.isDisabled=!1,t.$refs.departmentForm.resetFields(),t.initList(),t.updataRight()}))})},addDepartment:function(t){var e=this;console.log(t),this.visible=!0,this.location="1",this.dialogStatus="新增部门",this.departmentDialogVisible=!0,this.departmentForm.departmentName=void 0,this.checkoutId=t.value,this.checkoutParentId=t.parentId,t.parentName?this.departmentForm.parentId=t.parentId:this.departmentForm.parentId="1",this.$nextTick(function(){e.$refs.departmentForm.clearValidate()})},updataRight:function(){var t=this;"0"===this.location&&s(this.checkoutId).then(function(e){"0000"===e.data.code?t.subForm.departmentData=e.data.data:t.$message.error(e.data.result)})},initList:function(){var t=this;this.listLoading=!0,Object(i.a)({url:"system/sysDepartment/findDepartmentAllByLevel",method:"post"}).then(function(e){"0000"===e.data.code?t.departmentList=e.data.data:t.$message.error(e.data.result),t.listLoading=!1})}}},d=(a("+DZj"),a("r6jR"),a("KHd+")),l=Object(d.a)(o,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"departmentManagement"},[a("div",{staticClass:"department-left"},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.departmentList,"expand-on-click-node":!1,"default-expand-all":"","node-key":"id"},on:{"node-click":t.handleNodeClick},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,r=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{staticStyle:{"margin-right":"3px"}}),t._v(t._s(n.label)+"\n        ")]),t._v(" "),a("span",{staticStyle:{"margin-left":"20px"}},[a("i",{staticClass:"el-icon-plus",on:{click:function(){return t.addDepartment(r)}}}),t._v(" "),a("i",{staticClass:"el-icon-edit",on:{click:function(){return t.editDepartment(r)}}}),t._v(" "),a("i",{staticClass:"el-icon-delete",on:{click:function(){return t.deleteDepartment(r.value)}}})])])}}])})],1),t._v(" "),t.isData?a("div",{staticClass:"department-right"},[t.isSubForm?a("div",[t._v("没有子部门")]):t._e(),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.isDepartmentInfo,expression:"isDepartmentInfo"}]},[a("div",{staticClass:"department-title"},[t._v("下级部门")]),t._v(" "),a("div",{staticClass:"department-content"},[a("span",[t._v(t._s(t.currentDepartmentName))]),t._v(" "),a("el-form",{ref:"subForm",attrs:{rules:t.rules,model:t.subForm,"label-width":"100px"}},[t._l(t.subForm.departmentData,function(e,n){return a("el-form-item",{key:n,attrs:{prop:"departmentData."+n+".label",rules:t.departmentDataRules.label}},[a("el-input",{attrs:{clearable:"",maxlength:"20"},on:{blur:t.checkoutSubName},model:{value:e.label,callback:function(a){t.$set(e,"label",a)},expression:"item.label"}})],1)}),t._v(" "),a("el-form-item",{staticClass:"footer"},[a("el-button",{attrs:{disabled:t.isDisabled,type:"primary"},on:{click:function(e){t.submitDepartmentInfo("subForm")}}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:function(e){t.cencalEdit("subForm")}}},[t._v("取消")])],1)],2)],1)])]):t._e(),t._v(" "),a("el-dialog",{attrs:{visible:t.departmentDialogVisible,title:t.dialogStatus,width:"400px"},on:{"update:visible":function(e){t.departmentDialogVisible=e}}},[a("el-form",{ref:"departmentForm",attrs:{rules:t.rules,model:t.departmentForm,"label-width":"100px"}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],attrs:{label:"新增位置:"}},[a("el-radio",{attrs:{label:"1"},model:{value:t.location,callback:function(e){t.location=e},expression:"location"}},[t._v("同级部门")]),t._v(" "),a("el-radio",{attrs:{label:"0"},model:{value:t.location,callback:function(e){t.location=e},expression:"location"}},[t._v("子部门")])],1),t._v(" "),a("el-form-item",{attrs:{label:"部门名称:",prop:"departmentName"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"20"},model:{value:t.departmentForm.departmentName,callback:function(e){t.$set(t.departmentForm,"departmentName","string"==typeof e?e.trim():e)},expression:"departmentForm.departmentName"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{disabled:t.isDisabled,type:"primary"},on:{click:function(e){"新增部门"===t.dialogStatus?t.createData():t.updateData()}}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:function(e){t.departmentDialogVisible=!1}}},[t._v("取消")])],1)],1)],1)],1)},[],!1,null,"839acea0",null);l.options.__file="departmentManagement.vue";e.default=l.exports}}]);