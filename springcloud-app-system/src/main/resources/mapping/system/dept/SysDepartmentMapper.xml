<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jn.system.dept.dao.SysDepartmentMapper">

    <update id="deleteDepartmentBranch" parameterType="java.util.List">
        update tb_sys_department set status=-1
        where id in
        <foreach collection="list" item="id"
                 open="(" close=")" index="index" separator=",">
            #{id}
        </foreach>
    </update>

    <select id="findSysDepartmentAll" resultType="com.jn.system.dept.vo.SysDepartmentVO">
        select
        id,
        parent_id as parentId,
        department_name as label
        from tb_sys_department
        where parent_id = '1'
        and `status` = '1'
        ORDER BY create_time ASC
    </select>

    <select id="findChildrenDepartment" parameterType="java.lang.String"
            resultType="com.jn.system.dept.vo.SysDepartmentVO">
         select
            t.department_name as parentName,
            tt.id,
            tt.department_name as label,
            tt.parent_id as parentId
            from tb_sys_department t,
            (select
            id,
            parent_id,
            department_name
            from tb_sys_department
            where parent_id = #{parentId,jdbcType=VARCHAR}
            and `status` = '1'
            ORDER BY create_time ASC) tt
            where
            t.id = tt.parent_id
            and `status` = '1'
    </select>

    <select id="checkDepartmentName" parameterType="com.jn.system.dept.model.SysDepartmentCheckName"
            resultType="com.jn.system.dept.model.SysDepartment">
          SELECT
            id,department_name
            from tb_sys_department
            where parent_id = #{parentId,jdbcType=VARCHAR}
            and department_name = #{departmentName,jdbcType=VARCHAR}
            and `status` = '1' LIMIT 1
    </select>

    <select id="getDepartmentById" resultType="com.jn.system.dept.model.SysDepartment" parameterType="java.lang.String">
          SELECT id,department_name as departmentName,parent_id as parentId,`status`
          FROM `tb_sys_department` where id = #{id,jdbcType=VARCHAR} and `status` != '-1';
    </select>
</mapper>