<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jn.enterprise.servicemarket.product.dao.ServiceProductDao">
    <!--后台产品管理产品列表查询-->
    <select id="findServiceList" parameterType="hashmap" resultType = "com.jn.enterprise.servicemarket.product.model.ServiceProductManage">
        select
           t1.product_id as "productId",      <!--产品Id-->
           t1.product_name as "productName",  <!--产品名称-->
           t1.product_type as "productType",  <!--产品类型-->
           t1.signory_name as "signoryName",  <!--领域名称-->
           t1.release_time as "releaseTime",  <!--发布时间-->
           t1.status as "status",             <!--状态-->
           t2.org_name as "orgName",          <!--机构名称-->
           t3.con_phone as "conPhone",        <!--联系电话-->
           t3.con_name as "conName"           <!--联系人名称-->
        from tb_service_product t1
        left join tb_service_org t2 on t1.org_id = t2.ID
        left join  tb_service_org_info  t3 on t1.org_id = t3.org_id
        where 1=1
        <if test = "productName != null and productName!=''">
            and t1.product_name like concat("%",#{productName},"%")
        </if>
        <if test = "productType != null and productType!=''">
            and t1.product_type = #{productType}
        </if>
        <if test = "orgName != null and orgName!=''">
            and t2.org_name like concat("%",#{orgName},"%")
        </if>
        <if test = "signoryName != null and signoryName!=''">
            and t1.signory_name like concat("%",#{signoryName},"%")
        </if>
        <if test = "status != null and status!=''">
            and t1.status = #{status}
        </if>
        <if test = "startTime != null and startTime!=''">
            and t1.release_time &gt;= #{startTime}
        </if>
        <if test = "endTime != null and endTime!=''">
            and t1.release_time &lt;= #{endTime}
        </if>
    </select>
    <!--后台特色服务产品发布-->
    <select id="featuredProductRelease" parameterType="hashmap" resultType = "com.jn.enterprise.servicemarket.product.model.ServiceProductManage">
        select
        t1.product_id as "productId",      <!--产品Id-->
        t1.product_name as "productName",  <!--产品名称-->
        t1.signory_name as "signoryName",  <!--领域名称-->
        t1.release_time as "releaseTime",  <!--发布时间-->
        t1.status as "status",             <!--状态-->
        t2.org_name as "orgName",          <!--机构名称-->
        t3.con_phone as "conPhone",        <!--联系电话-->
        t3.con_name as "conName"           <!--联系人名称-->
        from tb_service_product t1
        left join tb_service_org t2 on t1.org_id = t2.ID
        left join  tb_service_org_info  t3 on t1.org_id = t3.org_id
        where t1.product_type = '1'
        <if test = "productName != null and productName!=''">
            and t1.product_name like concat("%",#{productName},"%")
        </if>
        <if test = "productType != null and productType!=''">
            and t1.product_type = #{productType}
        </if>
        <if test = "orgName != null and orgName!=''">
            and t2.org_name like concat("%",#{orgName},"%")
        </if>
        <if test = "signoryName != null and signoryName!=''">
            and t1.signory_name like concat("%",#{signoryName},"%")
        </if>
        <if test = "status != null and status!=''">
            and t1.status = #{status}
        </if>
        <if test = "startTime != null and startTime!=''">
            and t1.release_time &gt;= #{startTime}
        </if>
        <if test = "endTime != null and endTime!=''">
            and t1.release_time &lt;= #{endTime}
        </if>
        <if test = "orgType != null and orgType!=''">
        and t2.org_type= #{orgType}
    </if>
    </select>
    <!--产品详情查询-->
    <select id ="findServiceDetail" resultMap="serviceDetial">
      select
           t1.product_id as "productId",      <!--产品Id-->
           t1.serial_number as serialNumber,  <!--产品编号-->
           t1.product_name as "productName",  <!--产品名称-->
           t1.product_type as "productType",  <!--产品类型-->
           t1.signory_name as "signoryName",  <!--领域名称-->
           t1.refer_price as "referPrice",    <!--参考价格-->
           t1.service_cycle as "serviceCycle",<!--服务周期-->
           t1.release_time as "releaseTime",  <!--发布时间-->
           t1.picture_url as "pictureUrl",    <!--产品图片-->
           t1.status as "status",             <!--状态-->
           t1.approval_comments as "approvalComments", <!--审批意见-->
           t2.org_name as "orgName",          <!--机构名称-->
           t3.con_phone as "conPhone",        <!--联系电话-->
           t3.con_name as "conName",          <!--联系人名称-->
           t4.service_details as "serviceDetails" <!--服务详情-->
        from tb_service_product t1
        left join tb_service_org t2 on t1.org_id = t2.ID
        left join  tb_service_org_info  t3 on t1.org_id = t3.org_id
        left join tb_service_details t4 on t1.product_id = t4.product_id
        where t1.product_id = #{productId,jdbcType=VARCHAR}
    </select>
    <resultMap id="serviceDetial" type="com.jn.enterprise.servicemarket.product.model.ServiceProductDetail">
        <result column="orgName" property="orgName"/>
        <result column="conPhone" property="conPhone"/>
        <result column="conName" property="conName"/>
        <result column="status" property="status"/>
        <result column="approvalComments" property="approvalComments"/>
        <association property="content" javaType="com.jn.enterprise.servicemarket.product.model.ServiceContent">
            <result column="productId" property="productId"/>
            <result column="serialNumber" property="serialNumber"/>
            <result column="productName" property="productName"/>
            <result column="productType" property="productType"/>
            <result column="signoryName" property="signoryName"/>
            <result column="referPrice" property="referPrice"/>
            <result column="serviceCycle" property="serviceCycle"/>
            <result column="releaseTime" property="releaseTime"/>
            <result column="pictureUrl" property="pictureUrl"/>
            <result column="serviceDetails" property="serviceDetails"/>
        </association>
    </resultMap>
    <!--产品审批-->
    <update id="productApproval" >
        update tb_service_product t1 set t1.status = #{status},
        t1.approval_time = now(),t1.approval_account = #{account}
        <if test = "approvalComments != null and approvalComments!=''">
        ,approval_comments = #{approvalComments}
        </if>
         where t1.product_id = #{productId}
    </update>
    <!--产品上下架-->
    <update id="productShelf">
        update tb_service_product t1 set t1.status = #{status},
        t1.modifier_account = #{account},
        t1.modified_time = now()
        where t1.product_id = #{productId}
    </update>
</mapper>